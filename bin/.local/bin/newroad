#!/usr/bin/bash

projects_dir="$HOME/scratchpad/laravel/"

starters=(Laravel Symfony)

chosen=$(printf "%s\n" "${starters[@]}" | dmenu)

if [[ -z "$chosen" ]]; then
    notify-send "Cancelled" "no project created"
    exit 1
fi

_new_laravel() {
    name=$(printf ""| dmenu -p "Project name: ")
    if [[ -z $name ]]; then
        notify-send "empty name" "aborting new laravel project"
        exit 1
    fi
    name="${name// /-}"
    notify-send "New Laravel Project" "$name is being created"
    cd "$projects_dir" && curl -s "https://laravel.build/$name" | bash 
}

_new_symfony() {
    name=$(printf ""| dmenu -p "Project name: ")
    if [[ -z $name ]]; then
        notify-send "empty name" "aborting new symfony project"
        exit 1
    fi
    name="${name// /-}"
    notify-send "New Symfony Project" "$name is being created"
    target="$projects_dir/$name"
    zip_out="$target-zip"
    wget "https://github.com/dunglas/symfony-docker/archive/refs/heads/main.zip" -O "$zip_out-tmp"
    unzip "$zip_out-tmp" -d "$zip_out"
    mv "$zip_out/symfony-docker-main" "$target"
    rm -rf "$zip_out"
    rm "$zip_out-tmp"
    cd "$target" && \
        docker compose build --pull --no-cache && \
        docker compose up -d
}

"_new_${chosen,,}"
